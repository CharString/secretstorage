sudo: false
dist: trusty
language: python
matrix:
  include:
    - python: "3.5"
    - python: "3.6"
    - python: "3.7"
      sudo: required
      dist: xenial
addons:
  apt:
    packages:
    - dbus-x11
install:
  - pip install jeepney cryptography codecov mypy
before_script:
  - git clone https://gitlab.gnome.org/GNOME/libsecret.git
script:
  - dbus-launch --exit-with-session coverage run tests/run_tests.py libsecret/libsecret/mock-service-normal.py
  - dbus-launch --exit-with-session coverage run -a tests/run_tests.py libsecret/libsecret/mock-service-only-plain.py
  - dbus-launch --exit-with-session coverage run -a tests/run_tests.py libsecret/libsecret/mock-service-lock.py
  - mypy --strict --ignore-missing-imports secretstorage/ tests/
after_success:
  - codecov
